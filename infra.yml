# name: infra

# on:
#   push:
#     paths:
#       - "terraform/**"

# env:
#   AWS_ACCESS_KEY: ${{ secrets.AWS_ACCESS_KEY_ID }}
#   AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#   AWS_REGION: eu-west-3
#   TF_VAR_apex_domain: dev-knot.com
#   DEV: True

# defaults:
#   run:
#     working-directory: terraform

# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Clone
#         uses: actions/checkout@v2

#       - name: Setup Terraform
#         uses: hashicorp/setup-terraform@v1.1.0

#       - name: Terraform Init
#         timeout-minutes: 2
#         run: |
#           terraform init \
#               -input=false \
#               -backend=true \
#               -backend-config="region=${{ env.AWS_REGION }}" \
#               -backend-config="bucket=${{ secrets.S3_BACKEND }}" \
#               -backend-config="key=terraform" \
#               -reconfigure

#       - name: Terraform Format
#         run: terraform fmt -check

#       - name: Terraform Plan
#         run: terraform plan -out=terraform.plan

#       - name: Terraform Apply
#         run: terraform apply -auto-approve terraform.plan
